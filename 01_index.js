

// ðŸ”· ì„œë²„ ê¸°ì´ˆ ì„¤ì •
    // express ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
        const express = require("express");

    // ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ê¸° 
        const app = express();


// ðŸ”· ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§(?) ìœ„í•œ ê¸°ë³¸ ì„¤ì •? 
    // ë‚´ìž¥ëª¨ë“ˆ path 
        const path = require("path");

    // view ì—”ì§„ì´ 'ë Œë”ë§ í•  í…œí”Œë¦¿ íŒŒì¼'ì˜ 'ì†ŒìŠ¤ ê²½ë¡œ ë³€ê²½'
        app.set("views" , path.join(__dirname , "page"))

        // [view ì—”ì§„ ì„¤ëª…]
            // expressì—ì„œ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§ì„ ì§€ì›í•˜ê¸°ìœ„í•´ viewì—”ì§„ì„ ì‚¬ìš©í•œë‹¤.
            // viewì—”ì§„ì´ í…œí”Œë¦¿ íŒŒì¼ì„ ë³´ì—¬ì£¼ëŠ” ì—­í• ì„ í•´ì¤Œ
            // í…œí”Œë¦¿ í´ë”ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê¸°ë³¸ê°’ì€ views: 'C:\\Users\\KGA\\Desktop\\20230504\\views'ë¡œ ê²½ë¡œê°€ ì§€ì •
                // ì–´ë–»ê²Œ í™•ì¸ â“â“â“ ì„œë²„ë¥¼ ëŒë ¤ì„œ í™•ì¸í–ˆë˜ ê²ƒ ê°™ì€ë° 

        // [í…œí”Œë¦¿ íŒŒì¼ ì´ëž€?] â“â“â“â“â“
            // ìŒ.. ejs ë„ í•˜ë‚˜ ì¸ê±° ê°™ì€ë° ìŒ. 

    // 'view ì—”ì§„'ìœ¼ë¡œ 'ejs' ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆê²Œ ì„¤ì • 
        app.set("view engine" , "ejs");
            // [ì‚¬ì „ ìž‘ì—…] : ejs ì„¤ì¹˜ 
                // npm install ejs
            // [ì£¼ì˜í•  ì ]
                // ì²˜ìŒ ejs ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, npm install ejs ì„¤ì¹˜ í•´ì•¼ í•¨  
    
    // express ì—ì„œ body-Parser ë¥¼ ì§€ì› -> ë”°ë¼ì„œ, body-Parser ìƒëžµ 
        // body-Parser ê°€ ì–´ë–¤ ê¸°ëŠ¥ì„ í•˜ì§€â“â“â“â“â“ 

    // ì´ê²Œ ì–´ë””ì— ì™œ ì“°ì´ì§€â“â“â“â“â“ 
        app.use(express.urlencoded({extended : false}));
            // ê¹Šì€ ê°ì²´ë¥¼ ì§€ì›í• ì§€, ì•ˆ í• ì§€. 
            // í™•ìž¥ëœ ëª¨ë“ˆ ì‚¬ìš©í• ì§€ ì—¬ë¶€ : false ëŠ” ê¸°ë³¸ë§Œ ì‚¬ìš©í•˜ê¸° 
            // ê¶Œìž¥ì€ false ! 


// ðŸ”· sql ì—°ê²° 
    // ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
        const mysql2 = require("mysql2");

    // mysql ê³¼ ì—°ê²° 
        const _mysql = mysql2.createConnection({
            user : "root",  // ë³„ì¼ ì—†ìœ¼ë©´ root ë¡œ ìž‘ì„±
            password : "mysqlpwdj",  // mysql pw ê¸°ìž¬
            database : "test2",  // ì—°ê²°í•  ìŠ¤í‚¤ë§ˆ ì´ë¦„ ê¸°ìž¬
        
            multipleStatements : true 
                // ë‹¤ì¤‘ ì¿¼ë¦¬ë¬¸ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ì˜µì…˜ 
                // ê°ê°ì˜ ì¿¼ë¦¬ë¬¸ì„ ; ë¡œ êµ¬ë¶„í•˜ê²Œ ë¨.  
        })



// ðŸ“š íŽ˜ì´ì§€, ìš”ì²­íƒ€ìž… ë³„ ì²˜ë¦¬ 

    // '/' íŽ˜ì´ì§€ | GET ìš”ì²­ | render ì²˜ë¦¬  
    app.get('/' , (req, res) => {
        res.render("main")
    })
        // [êµ¬ë¬¸ í•´ì„]
            // app | ì„œë²„ë¼ëŠ” í”„ë¡œê·¸ëž¨ì´ ìžˆë‹¤.  
            // get | ëˆ„êµ°ê°€, app í•œí…Œ get ì´ë¼ëŠ” í˜•íƒœì˜ ìš”ì²­ì„ í•œë‹¤. 
                // ìš”ì²­ì„ í•œë‹¤ëŠ”ê²Œ, ì»´í“¨í„° ìƒì—ì„œëŠ” ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ëŠ”ê±°ì§€?
            // '/' | ì–´ë–¤ ì£¼ì†Œì— ëŒ€í•´ì„œ? ì–´ë–¤ ë°ì´í„°ì— ëŒ€í•´ì„œ? ì£¼ì†Œê°€ ë§žë‚˜? 
                // / ì´ë¼ëŠ” ì£¼ì†Œì— ëŒ€í•´ì„œ 
            // (req, res) | êµ¬ì²´ì ìœ¼ë¡œ ìš”ì²­ ë‚´ìš©ì´ ë­ì•¼? 
                // req ëŠ” ìš”ì²­í•œ ìª½ì˜ êµ¬ì²´ì ì¸ ìš”ì²­ ë‚´ìš©ì„ í‘œí˜„í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ìž„. 
                // res ëŠ” ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³ , ë‚œ ë‹¤ìŒ, ì´ ë³€ìˆ˜(ê°ì²´?) ë¥¼ í™œìš©í•´ì„œ ë³´ëƒ„ 
                    // res ìžì²´ëŠ” ë³´ë‚´ëŠ”ë° í™œìš© â“â“ 
            // res.render("main")
                // res ë¼ëŠ” ê°ì²´ê°€ ì–´ë”˜ê°€ì—ì„œ ë§Œë“¤ì–´ì§ 
                // ê·¸ ì•ˆì— res.render ë¼ëŠ” ë©”ì†Œë“œê°€ ìžˆìŒ. 
                // res.render ë©”ì†Œë“œì˜ ê¸°ëŠ¥ 
                    // 1) Expressì—ê²Œ (â­ ì„œë²„ì‚¬ì´ë“œì˜ ê·¼ê±°)
                    // 2) views íŒŒì¼ì— í•´ë‹¹í•˜ëŠ” "main"  ë¥¼ ì°¾ì•„ ë Œë”ë§í•˜ê³  
                    // 3) í•„ìš”í•œ ê²½ìš° í…œí”Œë¦¿ì„ ë™ì  ë°ì´í„°ì™€ ê²°í•© í•˜ê³  
                    // 4) ê·¸ ê²°ê³¼ë¥¼ HTMLì„ ë‹¤ìŒê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡í•˜ë„ë¡ ì§€ì‹œí•¨. 

        // [ê·¸ ë‹¤ìŒ ë²Œì–´ì§€ëŠ” ì¼]
            // 1) ë Œë”ë§ ì‹œì¼œì•¼ í•˜ëŠ” main íŒŒì¼ ì´ ì–´ë””ìžˆëŠ”ì§€ ì°¾ì•„ì•¼ í•œë‹¤. 
            // 2) ê·¸ëŸ¬ë©´, 'ì°¾ì„ ìˆ˜ ìžˆëŠ” ë­”ê°€' ê°€ ìžˆì–´ì•¼ í•œë‹¤. ì–´ë–»ê²Œ main íŒŒì¼ì„ ì°¾ì§€? 
                // a) app.set("views" , path.join(__dirname , "page")) ìœ¼ë¡œ ë Œë”í•  íŒŒì¼ ì°¾ì„ ê²½ë¡œë¥¼ 'views í´ë”' ì—ì„œ 'page í´ë”'ë¡œ ë³€ê²½ 
                // b) 


    // signup íŽ˜ì´ì§€ ë“¤ì–´ì™”ì„ ë•Œ > 000 ë³´ì´ê²Œ í•˜ê¸° 
    app.get('/signup' , (req, res) => {
        res.render("signup");
    })
    
    // login ì°½êµ¬ | GET ìš”ì²­ ì²˜ë¦¬  
    app.get('/login' , (req, res) => {
        res.render("login");
    })

    // login ì°½êµ¬ | POST ìš”ì²­ ì²˜ë¦¬ 
    app.post('/login' , (req, res) => {
        
        console.log(req.body)   
            // [í•´ì„] 
                // req ë¥¼ ì°ì–´ë³´ë‹ˆê¹Œ, body ì•ˆì—, login ì—ì„œ input ìœ¼ë¡œ ë³´ë‚¸ id ì™€ pw ê°€ ë“¤ì–´ê°€ ìžˆì–´. ê·¸ ì´ìœ ëŠ”? 
                    // 1) login íŽ˜ì´ì§€ì—ì„œ input ìœ¼ë¡œ ì „ë‹¬ëœ ê°’ì„ 'ë¯¸ë“¤ì›¨ì–´' ê°€ ë°›ìŒ 
                        // ì—¬ê¸° ì½”ë“œì—ì„œëŠ” 'app.use(express.urlencoded({extended : false}));' ë¼ê³  ì„¤ì •í–ˆìŒ. 
                    // 2) ë¯¸ë“¤ì›¨ì–´ê°€ input ìœ¼ë¡œ ë¶€í„° ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì²˜ë¦¬ í•¨. ('íŒŒì‹±' í•˜ëŠ” ê³¼ì •)
                    // 3) ê·¸ ê²°ê³¼, login íŽ˜ì´ì§€ì˜ input íƒœê·¸ì˜ ê°’ì´ ì„œë²„ì—ì„œ req.body ë¡œ ë³¼ ìˆ˜ ìžˆê²Œ ë¨.  

        // êµ¬ì¡° ë¶„í•´ í• ë‹¹ìœ¼ë¡œ id, pw ë°›ê¸° 
            const {user_id, user_pw} = req.body;
            console.log(user_id, user_pw)
        
        // user_id ì™€ user_pw ê°€ sql ì•ˆì— ìžˆëŠ”ì§€ ì¡°íšŒ 
        const sql = "SELECT * FROM users WHERE user_id = ? AND user_pw = ?";
            // SELECT * FROM users | 'users ë°ì´í„°í…Œì´ë¸”' ì—ì„œ 'ëª¨ë“  ë°ì´í„°(í–‰ê³¼ì—´)'ë¥¼ ê²€ìƒ‰ í•œë‹¤. 
            // WHERE | íŠ¹ì • ì¡°ê±´ë§Œ ë§Œë“ ê±¸ select í•´~ ë¼ëŠ” ì˜ë¯¸ 
            // [ì‚¬ì „ ì¡°ê±´]
                // sql ê³¼ ì—°ê²°ì´ ë˜ì–´ ìžˆì–´ì•¼ í•¨ 

        _mysql.query(sql, [user_id , user_pw], (err, result) => {
            if(err) {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                console.log(err)
                console.log("ë¡œê·¸ì¸ ì‹¤íŒ¨")

            } else {
                // ë¡œê·¸ì¸ ì„±ê³µ
                console.log(result)
                console.log("ë¡œê·¸ì¸ ì„±ê³µ")
            }
        })
            // [í•´ì„]
                // _mysql | mysql ì—ì„œ ì—°ê²°í•œ ê²ƒì„ ë‹´ì•„ë‘” ë³€ìˆ˜
                // query ë©”ì†Œë“œ | ðŸ“›ðŸ“›ðŸ“› ì´ê²Œ ì§€ê¸ˆ ì´í•´ê°€ ì•ˆ ë¼ 



    })




    // list íŽ˜ì´ì§€ ë“¤ì–´ì™”ì„ ë•Œ > 000 ë³´ì´ê²Œ í•˜ê¸° 
    app.get('/list' , (req, res) => {
        res.render("list")
    })

    // insert(ê²Œì‹œíŒ ë“±ë¡ íŽ˜ì´ì§€) ë“¤ì–´ì™”ì„ ë•Œ > 000 ë³´ì´ê²Œ í•˜ê¸° 
    app.get('/insert' , (req, res) => {
        res.render("insert")
    })
    
    // edit(ê²Œì‹œíŒ íŽ¸ì§‘ íŽ˜ì´ì§€) ë“¤ì–´ì™”ì„ ë•Œ > 000 ë³´ì´ê²Œ í•˜ê¸° 
    app.get('/edit' , (req, res) => {
        res.render("edit")
    })
    
    // delete(ê²Œì‹œíŒ ì‚­ì œ íŽ˜ì´ì§€) ë“¤ì–´ì™”ì„ ë•Œ > 000 ë³´ì´ê²Œ í•˜ê¸° 
    // app.get('/delete' , (req, res) => {
    //     // delete íŽ˜ì´ì§€ê°€ ìžˆì–´ì•¼ í• ê±° ê°™ì€ë° ì—†ë„¤? â“â“â“â“â“ 
    // })






// ðŸ”· ì„œë²„ ëŒ€ê¸° ìƒíƒœ 
    // í¬íŠ¸ ì§€ì •
        const PORT = 8070; 

    // app.listen
        app.listen(PORT, () => {

            console.log("ì„œë²„ ì—´ë¦¼ ðŸ™ŒðŸ™Œ")

        })



